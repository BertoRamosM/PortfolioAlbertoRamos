---
import BlogLayout from "../../../layouts/BlogLayout.astro";
import BlogHero from "../../../blogComponents/BlogHero.astro";
import BlogGallery from "../../../blogComponents/BlogGallery.astro";

import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const allBlogArticles: CollectionEntry<"blog">[] =
    await getCollection("blog");

  const tags = new Set<string>();
  allBlogArticles.forEach((article) => {
    if (article.data.tags) {
      article.data.tags.forEach((tag) => tags.add(tag));
    }
  });

  return Array.from(tags).map((tag) => ({
    params: {
      tag: tag,
    },
    props: { tag },
  }));
}

interface Props {
  tag: string;
}

const { tag }: Props = Astro.props;

const allArticles: CollectionEntry<"blog">[] = await getCollection("blog");

const filteredArticles = allArticles.filter((article) =>
  article.data.tags?.includes(tag)
);

const allBlogArticles = filteredArticles.sort((a, b) => {
  const dateA = new Date(a.data.pubDate).getTime();
  const dateB = new Date(b.data.pubDate).getTime();
  return dateB - dateA;
});
---

<BlogLayout
  title={`Blog Articles Tagged: ${tag} - Blog Alberto Ramos - Web Developer`}
  description={`Blog articles tagged with ${tag} by Alberto Ramos, a dynamic web developer driven by a passion for learning and a collaborative spirit.`}
>
  <BlogHero />
  <BlogGallery allBlogArticles={allBlogArticles} />
</BlogLayout>
